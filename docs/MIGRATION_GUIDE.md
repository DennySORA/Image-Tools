# 遷移指南：舊系統 → 統一後端

## 概述

本文檔幫助現有用戶從舊的多後端系統遷移到新的統一後端系統。

## 主要變更

### 背景移除選項簡化

**舊系統（多選項）**：
- rembg (多個模型)
- transparent-background
- backgroundremover
- greenscreen (專門針對綠幕)

**新系統（統一方案）**：
- **unified** - 單一強大的後端，整合所有優點

### 為什麼簡化？

1. **選擇困難**：太多選項讓用戶不知道該選哪個
2. **品質不一致**：不同後端品質差異大
3. **維護複雜**：多個後端增加維護成本
4. **最佳實踐**：經過研究，BiRefNet 是目前 SOTA 解決方案

## 遷移對照表

### 如果您之前使用...

#### rembg + birefnet-general/birefnet-massive

**舊設定**：
```
後端: rembg
模型: birefnet-general 或 birefnet-massive
強度: 0.5
```

**新設定**：
```
後端: unified (自動)
強度: 0.5-0.7
色彩過濾: 關閉
```

✅ **品質提升**：新系統加入了 Alpha Matting 和邊緣去污染

---

#### greenscreen（綠幕專用）

**舊設定**：
```
後端: greenscreen
模式: hybrid
強度: 0.7
```

**新設定**：
```
後端: unified
強度: 0.7-0.9
色彩過濾: 開啟 → 選擇「綠幕背景」
```

✅ **功能完整保留**：綠幕處理整合到統一後端的色彩過濾功能

---

#### rembg + u2net/isnet

**舊設定**：
```
後端: rembg
模型: u2net, isnet-general-use, 等
強度: 0.5
```

**新設定**：
```
後端: unified
強度: 0.5-0.7
色彩過濾: 關閉
```

✅ **品質大幅提升**：BiRefNet 比 U2Net/ISNet 更先進

---

#### transparent-background

**舊設定**：
```
後端: transparent-background
模式: base 或 fast
強度: 0.5
```

**新設定**：
```
後端: unified
強度: 0.5-0.7
色彩過濾: 關閉
```

✅ **品質提升 + 速度相當**：BiRefNet 在品質和速度之間取得更好平衡

---

#### backgroundremover

**舊設定**：
```
後端: backgroundremover
模型: u2net_human_seg
強度: 0.5
```

**新設定**：
```
後端: unified
強度: 0.6-0.8（人像推薦）
色彩過濾: 關閉
```

✅ **人像效果更好**：Alpha Matting 對頭髮邊緣處理更優秀

---

## 特殊場景遷移

### 場景 1：產品攝影（純白背景）

**舊做法**：
```
使用 rembg + birefnet-general
手動後處理清除白邊
```

**新做法**：
```
後端: unified
強度: 0.8
色彩過濾: 開啟 → 選擇「純白背景」
```

✅ **無需手動後處理**：自動清除白邊

---

### 場景 2：人像攝影（複雜背景）

**舊做法**：
```
使用 rembg + birefnet-portrait
強度: 0.5
反覆調整參數
```

**新做法**：
```
後端: unified
強度: 0.6-0.7
色彩過濾: 關閉
```

✅ **一次設定成功率更高**：Alpha Matting 自動處理頭髮邊緣

---

### 場景 3：影片幀處理（綠幕）

**舊做法**：
```
使用 greenscreen + hybrid mode
分別調整色度鍵參數
```

**新做法**：
```
後端: unified
強度: 0.8-0.9
色彩過濾: 開啟 → 選擇「綠幕背景」
```

✅ **參數更簡單**：統一強度控制，無需分別調整

---

## 調參指南

### 如何選擇強度？

舊系統與新系統的強度對應關係：

| 舊後端 | 舊強度 | 新強度 | 說明 |
|--------|--------|--------|------|
| rembg (birefnet) | 0.3-0.5 | 0.4-0.6 | 保守模式 |
| rembg (birefnet) | 0.5-0.7 | 0.6-0.8 | 平衡模式 |
| rembg (birefnet) | 0.7-1.0 | 0.8-1.0 | 激進模式 |
| greenscreen | 0.5-0.7 | 0.7-0.9 + 色彩過濾 | 綠幕優化 |
| u2net/isnet | 0.5 | 0.5-0.7 | 品質提升 |

**通用建議**：先從 **0.7** 開始嘗試

---

## 常見問題

### Q1: 我需要重新處理所有圖片嗎？

**答**：不一定。如果舊結果已滿意，無需重新處理。

**建議重新處理的情況**：
- 原始使用 u2net/isnet（品質提升明顯）
- 遇到頭髮/毛邊問題（Alpha Matting 改善顯著）
- 綠幕/純色背景有殘留（色彩過濾效果更好）

### Q2: 統一後端會更慢嗎？

**答**：速度相當，甚至可能更快。

- BiRefNet-massive 雖然名字有 "massive"，但經過優化
- 多階段處理都是自動化的，無需手動干預
- 批次處理有會話重用，整體效率高

### Q3: 我可以繼續使用舊後端嗎？

**答**：可以，但不推薦。

- 舊後端（rembg, transparent-background, backgroundremover, greenscreen）仍然存在
- 但 UI 已簡化，預設只顯示 unified
- 如果確實需要，可以在程式碼中手動呼叫

**風險**：
- 未來版本可能移除舊後端
- 不再維護舊後端的 bug 修復

### Q4: 遇到問題怎麼辦？

1. **先嘗試調整強度**：
   - 邊緣殘留 → 提高強度（0.7-0.9）
   - 前景損失 → 降低強度（0.5-0.6）

2. **確認是否該啟用色彩過濾**：
   - 純色背景 → 開啟色彩過濾
   - 複雜背景 → 關閉色彩過濾

3. **查看文檔**：
   - [統一後端技術文檔](UNIFIED_BACKEND.md)
   - 查看 FAQ 章節

4. **回報問題**：
   - 如果確認是 bug，請開 issue
   - 附上原圖、輸出圖、設定參數

---

## 測試建議

遷移到新系統後，建議進行以下測試：

### 測試清單

- [ ] **一般圖片測試**（複雜背景）
  - 強度：0.6-0.7
  - 色彩過濾：關閉
  - 預期：邊緣乾淨，無白邊

- [ ] **人像測試**（頭髮細節）
  - 強度：0.6-0.8
  - 色彩過濾：關閉
  - 預期：頭髮邊緣平滑，無鋸齒

- [ ] **綠幕測試**（如適用）
  - 強度：0.7-0.9
  - 色彩過濾：開啟（綠）
  - 預期：背景完全移除，無綠邊

- [ ] **產品攝影測試**（純白/黑背景，如適用）
  - 強度：0.8
  - 色彩過濾：開啟（白或黑）
  - 預期：背景完全移除，邊緣乾淨

### 對比測試

如果想量化品質提升，可以：

1. 保留一些舊系統的輸出
2. 用新系統重新處理相同圖片
3. 對比邊緣細節、顏色準確度、背景殘留

---

## 總結

### 遷移優勢

✅ **品質提升**：BiRefNet + Alpha Matting + 邊緣去污染
✅ **操作簡化**：無需選擇多個後端和模型
✅ **參數統一**：單一強度控制，更直觀
✅ **功能完整**：色彩過濾整合綠幕功能

### 遷移步驟

1. 閱讀本文檔，了解對照關係
2. 更新到最新版本：`git pull && uv sync`
3. 用測試圖片驗證新系統
4. 根據測試結果調整強度參數
5. 批次處理實際工作

### 需要幫助？

- 📚 [統一後端完整文檔](UNIFIED_BACKEND.md)
- 🐛 [回報問題](https://github.com/your-repo/issues)
- 💬 參考文檔中的 FAQ 章節

---

**更新日期**: 2026-02-08
**版本**: 1.0.0
