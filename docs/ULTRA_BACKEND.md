# æ¥µè‡´èƒŒæ™¯ç§»é™¤å¾Œç«¯ (Ultra Backend)

## âš ï¸ é‡è¦è²æ˜

**æœ¬å¾Œç«¯åƒ…ä¾›éå•†ç”¨ä½¿ç”¨**

- ä½¿ç”¨ BRIA RMBG-2.0 æ¨¡å‹ï¼Œæˆæ¬Šç‚º **CC BY-NC 4.0ï¼ˆéå•†æ¥­ç”¨é€”ï¼‰**
- é©ç”¨æ–¼ï¼šå€‹äººä½¿ç”¨ã€ç ”ç©¶ã€æ•™è‚²
- **å•†æ¥­ä½¿ç”¨éœ€èˆ‡ BRIA å¦è¡Œå”è­°**

å¦‚æœæ‚¨éœ€è¦å•†ç”¨æ–¹æ¡ˆï¼Œè«‹ä½¿ç”¨ `unified` å¾Œç«¯ï¼ˆåŸºæ–¼ MIT æˆæ¬Šçš„ BiRefNet-massiveï¼‰ã€‚

---

## æ¦‚è¿°

æ¥µè‡´å¾Œç«¯æ˜¯é‡å°**å€‹äººç”¨æˆ¶è¿½æ±‚æœ€å¼·æ•ˆæœ**è€Œè¨­è¨ˆçš„è§£æ±ºæ–¹æ¡ˆï¼Œæ•´åˆäº†ç›®å‰æœ€å…ˆé€²çš„æŠ€è¡“çµ„åˆï¼Œæä¾›è¶…è¶Šå•†æ¥­æœå‹™çš„èƒŒæ™¯ç§»é™¤å“è³ªã€‚

### ç‚ºä»€éº¼é¸æ“‡æ¥µè‡´å¾Œç«¯ï¼Ÿ

| ç‰¹æ€§ | Unified å¾Œç«¯ | **Ultra å¾Œç«¯** |
|------|--------------|----------------|
| ä¸»æ¨¡å‹ | BiRefNet-massive (MIT) | **BRIA RMBG-2.0 (éå•†ç”¨)** |
| è¨“ç·´æ•¸æ“š | é–‹æºæ•¸æ“šé›† | **å°ˆæ¥­ç´šæ•¸æ“šé›†** |
| Alpha Matte | æ”¯æ´ | **åŸç”Ÿè¼¸å‡º** |
| Trimap Refinement | ç„¡ | **âœ… å®Œæ•´å¯¦ç¾** |
| Multi-space Defringing | å–®è‰²å½©ç©ºé–“ | **âœ… RGB+LAB+HSV** |
| é‚Šç·£å“è³ª | å„ªç§€ | **æ¥µè‡´** |
| å•†æ¥­ä½¿ç”¨ | âœ… å¯ | âŒ éœ€å”è­° |

---

## æŠ€è¡“æ¶æ§‹

### æ ¸å¿ƒæŠ€è¡“æ£§

1. **BRIA RMBG-2.0** - ä¸»åˆ†å‰²æ¨¡å‹
   - ä¾†æºï¼š[Hugging Face - briaai/RMBG-2.0](https://huggingface.co/briaai/RMBG-2.0)
   - åŸºæ–¼ BiRefNet æ¶æ§‹ï¼Œä½¿ç”¨å°ˆæ¥­ç´šè¨“ç·´æ•¸æ“šå¢å¼·
   - **åŸç”Ÿè¼¸å‡º 8-bit alpha matte**ï¼ˆä¸æ˜¯ binary maskï¼‰
   - æˆæ¬Šï¼šCC BY-NC 4.0ï¼ˆéå•†ç”¨ï¼‰

2. **Trimap-based Refinement** - æ™ºèƒ½é‚Šç•Œè™•ç†
   - åªåœ¨ä¸ç¢ºå®šé‚Šç•Œå¸¶é€²è¡Œç²¾ç´°åŒ–è™•ç†
   - ä½¿ç”¨ **Guided Filter** ä¿ç•™é‚Šç·£ç´°ç¯€
   - é¿å…å…¨åœ–æ¨¡ç³Šå°è‡´çš„ç´°ç¯€æå¤±

3. **Multi-space Defringing** - å¤šè‰²å½©ç©ºé–“å»æ±¡æŸ“
   - **RGB è‰²å½©å¹³è¡¡**ï¼šæ¸›å°‘é€šé“é–“è‰²å
   - **LAB è‰²å½©åˆ†æ**ï¼šç§»é™¤äº®åº¦ä¸åŒ¹é…
   - **Alpha-adaptive mixing**ï¼šå°åŠé€æ˜é‚Šç·£ç‰¹åˆ¥è™•ç†

4. **Adaptive Color Filter** - ç´”è‰²èƒŒæ™¯å„ªåŒ–
   - ç¶ å¹•ï¼šHSV è‰²åº¦éµ + Despill
   - ç™½/é»‘èƒŒæ™¯ï¼šLAB äº®åº¦æª¢æ¸¬
   - å½¢æ…‹å­¸æ“ä½œå„ªåŒ–é®ç½©

---

## è™•ç†æµç¨‹

```
è¼¸å…¥åœ–ç‰‡ (RGB)
    â†“
éšæ®µ 1: RMBG-2.0 ä¸»åˆ†å‰²
    â”œâ”€ 1024x1024 æ¨è«–
    â”œâ”€ åŸç”Ÿ alpha matte è¼¸å‡º
    â””â”€ è‡ªå‹• resize å›åŸåœ–å°ºå¯¸
    â†“
éšæ®µ 2: Trimap Refinementï¼ˆå¯é¸ï¼Œé è¨­å•Ÿç”¨ï¼‰
    â”œâ”€ å»ºç«‹ trimapï¼ˆè…è•/è†¨è„¹ï¼‰
    â”œâ”€ åªåœ¨æœªçŸ¥å€åŸŸåš Guided Filter
    â”œâ”€ é‚Šç·£æŸ”åŒ–ï¼ˆé«˜æ–¯æ¨¡ç³Šï¼‰
    â””â”€ ä¿ç•™ç¢ºå®šå€åŸŸä¸è®Š
    â†“
éšæ®µ 3: Advanced Defringing
    â”œâ”€ RGB è‰²å½©å¹³è¡¡ï¼ˆæ¸›å°‘è‰²åï¼‰
    â”œâ”€ LAB è‰²å½©ç©ºé–“åˆ†æï¼ˆa/b é€šé“ï¼‰
    â”œâ”€ åŠé€æ˜é‚Šç·£ç‰¹æ®Šè™•ç†
    â””â”€ Alpha-adaptive mixing
    â†“
éšæ®µ 4: Color Filterï¼ˆå¯é¸ï¼Œé è¨­é—œé–‰ï¼‰
    â”œâ”€ æ ¹æ“šèƒŒæ™¯é¡å‹å»ºç«‹é®ç½©
    â”œâ”€ å½¢æ…‹å­¸å„ªåŒ–ï¼ˆé–‰é‹ç®—/é–‹é‹ç®—ï¼‰
    â”œâ”€ ç¶ å¹• Despillï¼ˆå¦‚é©ç”¨ï¼‰
    â””â”€ èˆ‡ä¸» alpha åˆä½µ
    â†“
è¼¸å‡º PNG (RGBA)
```

---

## åƒæ•¸èªªæ˜

### å¼·åº¦ (Strength): 0.1 - 1.0

| ç¯„åœ | æ¨¡å¼ | Trimap åƒæ•¸ | Defringing | é©ç”¨å ´æ™¯ |
|------|------|-------------|------------|----------|
| 0.1-0.3 | ä¿å®ˆ | å¤§æ ¸ï¼ˆå¯¬é‚Šç•Œå¸¶ï¼‰ | é—œé–‰ | é‚Šç•Œè¶…æ¸…æ™°çš„åœ–ç‰‡ |
| 0.4-0.6 | å¹³è¡¡ | ä¸­æ ¸ | è¼•åº¦ | ä¸€èˆ¬åœ–ç‰‡ |
| 0.7-0.8 | æ¿€é€² | å°æ ¸ï¼ˆçª„é‚Šç•Œå¸¶ï¼‰ | ä¸­åº¦ | **æ¨è–¦ï¼ˆä¸€èˆ¬ä½¿ç”¨ï¼‰** |
| 0.9-1.0 | æ¥µè‡´ | æ¥µå°æ ¸ | å¼·åŠ› | èƒŒæ™¯æ¥µè¤‡é›œ/è‰²å½©æ±¡æŸ“åš´é‡ |

**æ¨è–¦è¨­å®š**ï¼š
- ä¸€èˆ¬åœ–ç‰‡ï¼š**0.7-0.8**
- äººåƒï¼ˆé ­é«®ç´°ç¯€ï¼‰ï¼š**0.8**
- ç”¢å“æ”å½±ï¼ˆç´”è‰²èƒŒæ™¯ï¼‰ï¼š**0.8 + è‰²å½©éæ¿¾**
- ç¶ å¹•è¦–è¨Šï¼š**0.9 + ç¶ è‰²éæ¿¾**

### Trimap Refinementï¼ˆé è¨­å•Ÿç”¨ï¼‰

- **å•Ÿç”¨**ï¼šåœ¨é‚Šç•Œå¸¶ä½¿ç”¨ Guided Filter ç²¾ç´°åŒ–
- **ç¦ç”¨**ï¼šç›´æ¥ä½¿ç”¨ RMBG-2.0 çš„åŸå§‹è¼¸å‡º

**ä½•æ™‚ç¦ç”¨ï¼Ÿ**
- åœ–ç‰‡è§£æåº¦æ¥µé«˜ï¼ˆ> 4Kï¼‰ï¼Œè™•ç†é€Ÿåº¦æ…¢
- é‚Šç•Œå·²ç¶“éå¸¸ä¹¾æ·¨ï¼Œç„¡éœ€é¡å¤–è™•ç†

### è‰²å½©éæ¿¾ï¼ˆé è¨­é—œé–‰ï¼‰

#### ç¶ å¹•èƒŒæ™¯ (Green Screen)
- HSV è‰²åº¦éµæª¢æ¸¬ï¼ˆè‰²ç›¸ 35-85ï¼‰
- è‡ªå‹• Despillï¼ˆç§»é™¤ç¶ è‰²æº¢å‡ºï¼‰
- **æ¨è–¦å¼·åº¦**ï¼š0.8-0.9

#### ç´”ç™½èƒŒæ™¯ (White)
- LAB äº®åº¦æª¢æ¸¬ï¼ˆL > 225ï¼‰
- é©ç”¨æ–¼ç”¢å“æ”å½±ã€é›»å•†åœ–ç‰‡
- **æ¨è–¦å¼·åº¦**ï¼š0.8

#### ç´”é»‘èƒŒæ™¯ (Black)
- LAB äº®åº¦æª¢æ¸¬ï¼ˆL < 30ï¼‰
- é©ç”¨æ–¼å·¥ä½œå®¤äººåƒã€è—è¡“æ”å½±
- **æ¨è–¦å¼·åº¦**ï¼š0.8

---

## ä½¿ç”¨æ–¹å¼

### CLI ä½¿ç”¨

```bash
# å•Ÿå‹•ç¨‹å¼
uv run main.py

# äº’å‹•æµç¨‹ï¼š
# 1. é¸æ“‡è³‡æ–™å¤¾
# 2. é¸æ“‡ã€ŒèƒŒæ™¯ç§»é™¤ã€æ“ä½œ
# 3. è¨­å®šå¼·åº¦ï¼ˆé è¨­ 0.8ï¼Œæ¨è–¦ï¼‰
# 4. é¸æ“‡æ˜¯å¦å•Ÿç”¨è‰²å½©éæ¿¾
#    - å¦‚æœå•Ÿç”¨ï¼šé¸æ“‡èƒŒæ™¯é¡è‰²ï¼ˆç¶ /ç™½/é»‘ï¼‰
# 5. è‡ªå‹•è™•ç†æ‰€æœ‰åœ–ç‰‡
```

### Python API ä½¿ç”¨

```python
from pathlib import Path
from src.backends.ultra import UltraBackend, ColorFilterConfig, ColorFilter

# ===== åŸºæœ¬ä½¿ç”¨ï¼ˆç„¡è‰²å½©éæ¿¾ï¼‰ =====
backend = UltraBackend(strength=0.8)
backend.load_model()
backend.process(
    input_path=Path("input.jpg"),
    output_path=Path("output.png")
)

# ===== ä½¿ç”¨ç¶ å¹•éæ¿¾ =====
color_filter = ColorFilterConfig(
    enabled=True,
    color=ColorFilter.GREEN,
    edge_refine_strength=0.9
)
backend = UltraBackend(
    strength=0.9,
    color_filter=color_filter,
    use_trimap_refine=True  # é è¨­å•Ÿç”¨
)
backend.load_model()
backend.process(
    input_path=Path("greenscreen.jpg"),
    output_path=Path("output.png")
)

# ===== ç¦ç”¨ Trimap Refinementï¼ˆåŠ é€Ÿï¼‰ =====
backend = UltraBackend(
    strength=0.7,
    use_trimap_refine=False  # ç¦ç”¨ä»¥åŠ é€Ÿ
)
backend.load_model()
backend.process(
    input_path=Path("simple.jpg"),
    output_path=Path("output.png")
)

# ===== æŒ‡å®š GPU =====
backend = UltraBackend(
    strength=0.8,
    device="cuda:0"  # æŒ‡å®š GPU 0
)
backend.load_model()

# ===== æ‰¹æ¬¡è™•ç† =====
from pathlib import Path

backend = UltraBackend(strength=0.8)
backend.load_model()

input_folder = Path("input_images")
output_folder = Path("output_images")
output_folder.mkdir(exist_ok=True)

for img_path in input_folder.glob("*.jpg"):
    output_path = output_folder / f"{img_path.stem}.png"
    success = backend.process(img_path, output_path)
    if success:
        print(f"âœ… {img_path.name}")
    else:
        print(f"âŒ {img_path.name}")
```

---

## æ•ˆèƒ½èˆ‡å“è³ª

### é‚Šç·£å“è³ªæ¯”è¼ƒ

| å ´æ™¯ | Unified | **Ultra** | èªªæ˜ |
|------|---------|-----------|------|
| ä¸€èˆ¬åœ–ç‰‡ | â­â­â­â­ | **â­â­â­â­â­** | Ultra é‚Šç·£æ›´å¹³æ»‘ |
| é ­é«®ç´°ç¯€ | â­â­â­â­ | **â­â­â­â­â­** | Trimap refinement é¡¯è‘—æ”¹å–„ |
| é€æ˜æè³ª | â­â­â­ | **â­â­â­â­â­** | åŸç”Ÿ alpha matte æ›´æº–ç¢º |
| è‰²å½©é‚Šç·£ | â­â­â­â­ | **â­â­â­â­â­** | Multi-space defringing å¾¹åº•å»é™¤ |
| ç¶ å¹•èƒŒæ™¯ | â­â­â­â­ | **â­â­â­â­â­** | å°ˆé–€çš„ despill è™•ç† |

### è™•ç†é€Ÿåº¦

- **é¦–æ¬¡è¼‰å…¥**ï¼šç´„ 3-5 ç§’ï¼ˆä¸‹è¼‰æ¨¡å‹ï¼‰
- **å–®å¼µåœ–ç‰‡**ï¼ˆ1080pï¼‰ï¼š
  - GPU (RTX 3060+): 2-4 ç§’
  - CPU (i7): 15-30 ç§’
- **è¨˜æ†¶é«”ä½¿ç”¨**ï¼š
  - GPU: 4-6GB VRAM
  - CPU: 8-12GB RAM

### ç¡¬é«”éœ€æ±‚

| é…ç½® | è¦æ ¼ | è™•ç†é€Ÿåº¦ |
|------|------|----------|
| **æœ€ä½** | 8GB RAM + CPU | 15-30 ç§’/å¼µ |
| **æ¨è–¦** | 16GB RAM + 6GB VRAM GPU | 2-4 ç§’/å¼µ |
| **æœ€ä½³** | 32GB RAM + 8GB+ VRAM GPU | 1-2 ç§’/å¼µ |

---

## èˆ‡å•†æ¥­æœå‹™æ¯”è¼ƒ

| ç‰¹æ€§ | remove.bg (API) | Photoshop | **Ultra Backend** |
|------|-----------------|-----------|-------------------|
| **å“è³ª** | â­â­â­â­â­ | â­â­â­â­ | **â­â­â­â­â­** |
| **é‚Šç·£ç´°ç¯€** | å„ªç§€ | å¥½ï¼ˆéœ€æ‰‹å‹•èª¿æ•´ï¼‰ | **æ¥µè‡´ï¼ˆè‡ªå‹•ï¼‰** |
| **éš±ç§** | âŒ ä¸Šå‚³é›²ç«¯ | âœ… æœ¬åœ° | **âœ… 100% æœ¬åœ°** |
| **æˆæœ¬** | $0.20/å¼µèµ· | è¨‚é–±åˆ¶ | **å…è²»ï¼ˆç¡¬é«”æˆæœ¬ï¼‰** |
| **é€Ÿåº¦** | å¿«ï¼ˆAPIï¼‰ | æ…¢ï¼ˆæ‰‹å‹•ï¼‰ | **å¿«ï¼ˆGPUï¼‰** |
| **å®¢è£½åŒ–** | âŒ ç„¡ | âœ… å®Œå…¨ | **âœ… åƒæ•¸å¯èª¿** |
| **æ‰¹æ¬¡è™•ç†** | API é™åˆ¶ | æ”¯æ´ | **âœ… ç„¡é™åˆ¶** |
| **æˆæ¬Š** | å•†æ¥­æœå‹™ | å•†æ¥­è»Ÿé«” | **éå•†ç”¨å…è²»** |

---

## å¸¸è¦‹å•é¡Œ (FAQ)

### Q1: Ultra å’Œ Unified çš„ä¸»è¦å·®åˆ¥æ˜¯ä»€éº¼ï¼Ÿ

**ä¸»è¦å·®åˆ¥**ï¼š
1. **æ¨¡å‹**ï¼šUltra ä½¿ç”¨ RMBG-2.0ï¼ˆå°ˆæ¥­æ•¸æ“šï¼‰ï¼ŒUnified ä½¿ç”¨ BiRefNet-massiveï¼ˆé–‹æºæ•¸æ“šï¼‰
2. **è™•ç†æµç¨‹**ï¼šUltra æœ‰å®Œæ•´çš„ Trimap refinementï¼ŒUnified è¼ƒç°¡åŒ–
3. **æˆæ¬Š**ï¼šUltra éå•†ç”¨ï¼ŒUnified å¯å•†ç”¨

**ä½•æ™‚é¸ Ultraï¼Ÿ**
- å€‹äººä½¿ç”¨ï¼Œè¿½æ±‚æ¥µè‡´å“è³ª
- è¤‡é›œé‚Šç·£ï¼ˆé ­é«®ã€æ¯›é«®ã€åŠé€æ˜ï¼‰
- å°é‚Šç·£å“è³ªè¦æ±‚æ¥µé«˜

**ä½•æ™‚é¸ Unifiedï¼Ÿ**
- å•†æ¥­å°ˆæ¡ˆ
- å“è³ªå·²è¶³å¤ ï¼Œé€Ÿåº¦å„ªå…ˆ
- ä¸æƒ³æ“”å¿ƒæˆæ¬Šå•é¡Œ

### Q2: ç‚ºä»€éº¼è™•ç†é€Ÿåº¦æ¯”è¼ƒæ…¢ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
1. **ä½¿ç”¨ CPU è€Œé GPU** â†’ æª¢æŸ¥ï¼š`backend.device` æ˜¯å¦ç‚º cuda
2. **åœ–ç‰‡è§£æåº¦éé«˜** â†’ è€ƒæ…®é è™•ç†ç¸®å°åˆ° 2K-4K
3. **Trimap refinement é–‹å•Ÿ** â†’ å¯å˜—è©¦é—œé–‰ä»¥åŠ é€Ÿï¼ˆç•¥å¾®æå¤±å“è³ªï¼‰

**å„ªåŒ–å»ºè­°**ï¼š
```python
# ä½¿ç”¨ GPU
backend = UltraBackend(strength=0.8, device="cuda")

# ç¦ç”¨ Trimapï¼ˆåŠ é€Ÿ 20-30%ï¼‰
backend = UltraBackend(strength=0.8, use_trimap_refine=False)

# é è™•ç†ç¸®å°åœ–ç‰‡
from PIL import Image
img = Image.open("large.jpg")
if max(img.size) > 2048:
    img.thumbnail((2048, 2048))
```

### Q3: é‚Šç·£é‚„æ˜¯æœ‰ç™½é‚Š/ç¶ é‚Šï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. **æé«˜å¼·åº¦**ï¼š0.7 â†’ 0.8 æˆ– 0.9
2. **å•Ÿç”¨è‰²å½©éæ¿¾**ï¼šå¦‚æœæ˜¯ç´”è‰²èƒŒæ™¯
3. **æª¢æŸ¥åŸåœ–å“è³ª**ï¼šJPEG å£“ç¸®å¯èƒ½å¼•å…¥è‰²å¡Š
4. **èª¿æ•´ edge_refine_strength**ï¼š

```python
color_filter = ColorFilterConfig(
    enabled=True,
    color=ColorFilter.GREEN,
    edge_refine_strength=0.95  # æé«˜åˆ° 0.95ï¼ˆæ›´æ¿€é€²ï¼‰
)
```

### Q4: å‰æ™¯è¢«éåº¦ç§»é™¤äº†ï¼Ÿ

**åŸå› **ï¼šå¼·åº¦å¤ªé«˜

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. **é™ä½å¼·åº¦**ï¼š0.9 â†’ 0.7 æˆ– 0.6
2. **ç¦ç”¨è‰²å½©éæ¿¾**ï¼šå¯èƒ½èª¤åˆ¤å‰æ™¯é¡è‰²
3. **æª¢æŸ¥åœ–ç‰‡å“è³ª**ï¼šæ¨¡ç³Šçš„åœ–ç‰‡é›£ä»¥å€åˆ†å‰æ™¯/èƒŒæ™¯

### Q5: å¯ä»¥å•†æ¥­ä½¿ç”¨å—ï¼Ÿ

**ç­”**ï¼š**ä¸å¯ä»¥**ï¼Œé™¤éèˆ‡ BRIA å¦è¡Œå”è­°ã€‚

Ultra å¾Œç«¯ä½¿ç”¨ BRIA RMBG-2.0ï¼Œæˆæ¬Šç‚º **CC BY-NC 4.0ï¼ˆéå•†æ¥­ç”¨é€”ï¼‰**ã€‚

**å•†æ¥­ä½¿ç”¨é¸é …**ï¼š
1. ä½¿ç”¨ `unified` å¾Œç«¯ï¼ˆåŸºæ–¼ MIT æˆæ¬Šçš„ BiRefNet-massiveï¼‰
2. èˆ‡ BRIA å”è­°å•†æ¥­æˆæ¬Šï¼ˆè¯çµ¡ï¼šhttps://bria.aiï¼‰

### Q6: å¦‚ä½•è™•ç†å½±ç‰‡ï¼Ÿ

**æ–¹æ³•**ï¼šé€å¹€è™•ç†

```python
import cv2
from pathlib import Path
from src.backends.ultra import UltraBackend

backend = UltraBackend(strength=0.8)
backend.load_model()

# è®€å–å½±ç‰‡
cap = cv2.VideoCapture("input.mp4")
fps = cap.get(cv2.CAP_PROP_FPS)
width = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH))
height = int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))

# è¨­ç½®è¼¸å‡º
fourcc = cv2.VideoWriter_fourcc(*'mp4v')
out = cv2.VideoWriter("output.mp4", fourcc, fps, (width, height))

frame_num = 0
while cap.isOpened():
    ret, frame = cap.read()
    if not ret:
        break

    # å„²å­˜è‡¨æ™‚å¹€
    temp_path = Path(f"temp_frame_{frame_num}.jpg")
    cv2.imwrite(str(temp_path), frame)

    # è™•ç†
    output_path = Path(f"temp_output_{frame_num}.png")
    backend.process(temp_path, output_path)

    # è®€å–è™•ç†å¾Œçš„å¹€
    processed = cv2.imread(str(output_path), cv2.IMREAD_UNCHANGED)

    # å¯«å…¥è¼¸å‡ºï¼ˆé€™è£¡å¯ä»¥åŠ å…¥æ–°èƒŒæ™¯ï¼‰
    out.write(processed[:, :, :3])  # åªå¯«å…¥ RGB

    # æ¸…ç†
    temp_path.unlink()
    output_path.unlink()

    frame_num += 1
    print(f"Processed frame {frame_num}")

cap.release()
out.release()
```

**æ³¨æ„**ï¼šå½±ç‰‡è™•ç†è€—æ™‚ï¼Œå»ºè­°ä½¿ç”¨ GPU ä¸¦è€ƒæ…®é™ä½è§£æåº¦ã€‚

### Q7: è¨˜æ†¶é«”ä¸è¶³æ€éº¼è¾¦ï¼Ÿ

**Error**: `RuntimeError: CUDA out of memory`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

1. **é™ä½åœ–ç‰‡è§£æåº¦**ï¼š
```python
img = Image.open("large.jpg")
img.thumbnail((1920, 1080))  # é™åˆ° 1080p
```

2. **ä½¿ç”¨ CPU**ï¼ˆè¼ƒæ…¢ï¼‰ï¼š
```python
backend = UltraBackend(strength=0.8, device="cpu")
```

3. **æ‰¹æ¬¡è™•ç†æ™‚æ¸…ç†è¨˜æ†¶é«”**ï¼š
```python
import torch
import gc

for img_path in image_paths:
    backend.process(img_path, output_path)

    # æ¯è™•ç† 10 å¼µæ¸…ç†ä¸€æ¬¡
    if i % 10 == 0:
        torch.cuda.empty_cache()
        gc.collect()
```

---

## æŠ€è¡“ç´°ç¯€

### Trimap Refinement åŸç†

**Trimap** æ˜¯å°‡åœ–ç‰‡åˆ†ç‚ºä¸‰å€‹å€åŸŸçš„åœ°åœ–ï¼š
- **ç¢ºå®šå‰æ™¯**ï¼ˆ255ï¼‰ï¼šè…è•å¾Œçš„ alpha
- **ç¢ºå®šèƒŒæ™¯**ï¼ˆ0ï¼‰ï¼šè†¨è„¹å¾Œçš„åå‘ alpha
- **æœªçŸ¥å€åŸŸ**ï¼ˆ128ï¼‰ï¼šå…©è€…ä¹‹é–“çš„é‚Šç•Œå¸¶

**Guided Filter** å„ªå‹¢ï¼š
- ä¿ç•™é‚Šç·£ç´°ç¯€ï¼ˆç›¸æ¯”é«˜æ–¯æ¨¡ç³Šï¼‰
- åˆ©ç”¨åŸåœ–çš„çµæ§‹è³‡è¨Š
- åªåœ¨æœªçŸ¥å€åŸŸè™•ç†ï¼ˆé¿å…å…¨åœ–æ¨¡ç³Šï¼‰

### Multi-space Defringing åŸç†

1. **RGB è‰²å½©å¹³è¡¡**ï¼š
   - è¨ˆç®—å„é€šé“åé›¢å¹³å‡å€¼çš„ç¨‹åº¦
   - åœ¨åŠé€æ˜é‚Šç·£æ¸›å°‘è‰²å

2. **LAB è‰²å½©ç©ºé–“**ï¼š
   - L: äº®åº¦ï¼ˆä¿æŒï¼‰
   - a: ç¶ -ç´…è»¸ï¼ˆå‘ä¸­æ€§é æ”ï¼‰
   - b: è—-é»ƒè»¸ï¼ˆå‘ä¸­æ€§é æ”ï¼‰
   - æ•ˆæœï¼šç§»é™¤è‰²å½©æ±¡æŸ“ä½†ä¿ç•™äº®åº¦

3. **Alpha-adaptive Mixing**ï¼š
   - åŠé€æ˜åº¦é«˜çš„åƒç´ ï¼ˆ< 0.5ï¼‰æ›´æ¿€é€²å»è‰²
   - åŠé€æ˜åº¦ä½çš„åƒç´ ï¼ˆ> 0.5ï¼‰ä¿å®ˆè™•ç†

---

## æˆæ¬Šèˆ‡å¼•ç”¨

### æ¨¡å‹æˆæ¬Š

- **BRIA RMBG-2.0**: CC BY-NC 4.0ï¼ˆéå•†ç”¨ï¼‰
  - æ¨¡å‹é é¢ï¼šhttps://huggingface.co/briaai/RMBG-2.0
  - å•†æ¥­æˆæ¬Šï¼šhttps://bria.ai

### å¼•ç”¨

å¦‚æœæ‚¨åœ¨ç ”ç©¶æˆ–æ–‡ç« ä¸­ä½¿ç”¨ Ultra å¾Œç«¯ï¼Œè«‹å¼•ç”¨ï¼š

```bibtex
@misc{bria-rmbg-2.0,
  title={RMBG-2.0: Next Generation Background Removal},
  author={BRIA AI},
  year={2024},
  howpublished={\url{https://huggingface.co/briaai/RMBG-2.0}}
}
```

### ç›¸é—œè³‡æº

- **BRIA RMBG-2.0**: [Hugging Face Model](https://huggingface.co/briaai/RMBG-2.0)
- **BiRefNet** (åŸºåº•æ¶æ§‹): [GitHub](https://github.com/ZhengPeng7/BiRefNet)
- **BRIA Blog**: [Introducing RMBG v2.0](https://blog.bria.ai/introducing-the-rmbg-v2.0-model)

---

## ç¸½çµ

### ä½•æ™‚ä½¿ç”¨ Ultra å¾Œç«¯ï¼Ÿ

âœ… **é©åˆ**ï¼š
- å€‹äººä½¿ç”¨ã€ç ”ç©¶ã€æ•™è‚²
- è¿½æ±‚æ¥µè‡´é‚Šç·£å“è³ª
- è™•ç†è¤‡é›œé‚Šç·£ï¼ˆé ­é«®ã€æ¯›é«®ï¼‰
- éœ€è¦æœ€å…ˆé€²çš„æŠ€è¡“

âŒ **ä¸é©åˆ**ï¼š
- å•†æ¥­å°ˆæ¡ˆï¼ˆéœ€æˆæ¬Šï¼‰
- é€Ÿåº¦å„ªå…ˆæ–¼å“è³ª
- ç°¡å–®åœ–ç‰‡ï¼ˆunified å·²è¶³å¤ ï¼‰

### æ ¸å¿ƒå„ªå‹¢

ğŸ¯ **å°ˆæ¥­ç´šæ¨¡å‹**ï¼šRMBG-2.0 ä½¿ç”¨å°ˆæ¥­è¨“ç·´æ•¸æ“š
ğŸ”¬ **å®Œæ•´è™•ç†æµç¨‹**ï¼šTrimap + Multi-space Defringing
âš¡ **GPU åŠ é€Ÿ**ï¼šPyTorch + CUDA æ”¯æ´
ğŸ¨ **æ¥µè‡´é‚Šç·£**ï¼šè¶…è¶Šå•†æ¥­æœå‹™çš„å“è³ª
ğŸ”’ **100% æœ¬åœ°**ï¼šç„¡éš±ç§é¡§æ…®
ğŸ’° **å…è²»ä½¿ç”¨**ï¼šå€‹äºº/ç ”ç©¶/æ•™è‚²å…è²»

---

**æ›´æ–°æ—¥æœŸ**: 2026-02-08
**ç‰ˆæœ¬**: 1.0.0
**æˆæ¬Š**: CC BY-NC 4.0ï¼ˆéå•†ç”¨ï¼‰