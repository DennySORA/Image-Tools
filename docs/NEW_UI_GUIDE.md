# 新版 UI 使用指南

## 🎨 全新的現代化介面

我們使用 **InquirerPy** 重新設計了整個使用者介面，提供更流暢、更美觀的操作體驗！

---

## ✨ 主要改進

### 1. **美觀的互動介面**
- 🎯 類似 Rust CLI 工具的現代化設計
- 🌈 清晰的視覺層次和分隔線
- 💡 即時的操作提示

### 2. **更直覺的操作流程**
重新調整操作順序，更符合實際使用場景：
```
1️⃣ 水印移除 (Gemini AI 浮水印)
      ↓
2️⃣ 圖片分割 (精靈圖切割)
      ↓
3️⃣ 背景移除 (AI 去背)
```

### 3. **無縫的鍵盤導航**
- `↑` `↓` 方向鍵：選擇選項
- `Enter`：確認選擇
- `ESC`：返回上一步
- 支援 **vi 模式**（可選）

### 4. **智能歷史記錄**
- 📁 自動記住最近使用的資料夾
- ⚡ 快速選擇常用路徑
- 🔍 支援模糊搜尋（檔案路徑選擇時）

### 5. **零確認提示**
- ❌ 移除所有「是否繼續？」的提示
- ✅ 流暢直接的操作流程
- 🔄 處理完成自動返回主選單

---

## 🚀 使用方法

### 基本操作流程

```bash
$ python main.py
```

#### 步驟 1：選擇資料夾
```
============================================================
                    🎨  圖片處理工具  🎨
============================================================

💡 提示：使用 ↑↓ 方向鍵選擇，Enter 確認，ESC 返回

? 選擇輸入資料夾:
  ────────────────── 📁 最近使用 ──────────────────
❯   test_folder (./test)
    images (./data/images)
  ──────────────────────────────────────────────────
    📝 輸入新路徑...
```

#### 步驟 2：選擇操作類型
```
? 選擇要執行的操作:
  ───────────── 🎯 選擇操作類型 ─────────────
❯ 🚿 水印移除 - 移除 Gemini AI 浮水印
  ✂️  圖片分割 - 將精靈圖分割成獨立物件
  🎨 背景移除 - 使用 AI 移除背景
```

#### 步驟 3：自動選擇後端
根據你選擇的操作，系統會自動選擇或讓你選擇適合的後端：

**水印移除：**
- 自動使用 `gemini-watermark` 後端

**圖片分割：**
- 自動使用 `image-splitter` 後端
- 選擇畫布模式：max / tight / original

**背景移除：**
```
? 選擇後端:
  ──────── 🔧 background-removal - 選擇後端 ────────
❯   rembg - Rembg - 支援多種模型 (BiRefNet, ISNet, U2Net)
    transparent-background - Transparent Background - 使用 InSPyReNet 模型
    backgroundremover - BackgroundRemover - 支援 Alpha Matting 邊緣優化
    greenscreen - 綠幕專用 - 混合方案 (色度鍵 + AI + Despill)
```

#### 步驟 4：配置參數
```
? 選擇模型:
  ────────── ⚙️  rembg - 選擇模型 ──────────
❯   birefnet-general
    birefnet-general-lite
    birefnet-portrait
    isnet-general-use
    u2net

? 設定處理強度 (0.1-1.0): 0.5
```

#### 步驟 5：自動處理
```
============================================================
                         📋 處理設定摘要
============================================================

  📁 輸入資料夾: /home/user/images
  🔧 後端: rembg
  ⚙️  模型: birefnet-general
  💪 強度: 0.50
  📂 輸出資料夾: /home/user/images/output

============================================================

⏳ 開始處理...

[████████████████████████████] 100% (10/10 張)

============================================================
                          ✅ 處理完成！
============================================================

  📊 總計: 10 張圖片
  ✅ 成功: 10 張
  📂 輸出: /home/user/images/output

============================================================

🔄 返回主選單...
```

---

## ⌨️ 快捷鍵

| 按鍵 | 功能 |
|------|------|
| `↑` / `k` | 向上選擇 |
| `↓` / `j` | 向下選擇 |
| `Enter` / `Space` | 確認選擇 |
| `ESC` / `Ctrl+C` | 返回上一步 / 退出 |
| `Home` | 跳到第一個選項 |
| `End` | 跳到最後一個選項 |
| `PageUp` / `PageDown` | 快速翻頁 |

> **提示**：啟用 vi 模式後可以使用 `h` `j` `k` `l` 進行導航

---

## 📋 操作類型詳解

### 1. 水印移除 🚿
**適用場景：** Gemini AI 生成的圖片帶有浮水印

**後端：** `gemini-watermark`

**特點：**
- 自動檢測浮水印位置
- 智能修復浮水印區域
- 保留原圖品質

**參數：**
- 強度固定為 1.0（最佳效果）

---

### 2. 圖片分割 ✂️
**適用場景：** 精靈圖（Sprite Sheet）需要分割成獨立物件

**後端：** `image-splitter`

**特點：**
- 智能檢測透明區域
- 自動分離多個物件
- 支援多種畫布模式

**畫布模式：**
- **max** - 所有輸出統一尺寸（最大物件）
- **tight** - 最小裁切，無額外空白
- **original** - 保持原始位置和尺寸

**參數：**
- 強度：0.1-1.0（控制透明邊距，0.1=2px, 1.0=16px）

---

### 3. 背景移除 🎨
**適用場景：** 移除圖片背景，保留主體

**可選後端：**

#### **rembg** （推薦）
- 最強大的背景移除
- 支援多種模型
- BiRefNet 系列效果最佳

#### **transparent-background**
- 快速處理
- 適合大批量

#### **backgroundremover**
- Alpha Matting 邊緣優化
- 適合細緻邊緣

#### **greenscreen**
- 綠幕專用
- 混合 AI + 色度鍵

**參數：**
- 強度：0.1-1.0（影響邊緣處理）

---

## 🎯 使用技巧

### 1. 快速選擇最近路徑
最近使用的資料夾會自動出現在列表頂部，直接 Enter 即可選擇。

### 2. 批次處理
處理完成後會自動返回主選單，可以立即處理下一個資料夾，無需重啟程式。

### 3. ESC 返回
在任何步驟都可以按 ESC 返回上一步，修改選擇。

### 4. 流暢操作
整個流程無需任何「確認」，選擇完畢立即執行，效率最大化。

---

## 🆚 新舊介面對比

| 特性 | 舊版 UI | 新版 UI |
|------|---------|---------|
| **介面風格** | 純文字輸入 | 美觀的選擇器 |
| **導航方式** | 手動輸入數字 | 方向鍵選擇 |
| **確認提示** | 多次確認 | 零確認 |
| **歷史記錄** | 無 | 自動記住 |
| **返回功能** | 無法返回 | ESC 返回 |
| **操作順序** | 固定（背景移除） | 三種操作可選 |
| **視覺效果** | 單調 | 美觀（顏色、emoji） |

---

## 🔧 進階配置

### 自訂 vi 模式
編輯 `src/ui/modern.py`，找到 `vi_mode=True` 並設為 `False` 以禁用 vi 快捷鍵。

### 調整歷史記錄數量
在 `_select_folder` 方法中修改：
```python
for path_str in recent_paths[:5]:  # 改為你想要的數量
```

### 自訂操作順序
在 `ModernUI.__init__` 中修改 `_operation_order`：
```python
self._operation_order = [
    "watermark-removal",
    "image-splitting",
    "background-removal",
]
```

---

## 🐛 常見問題

### Q: 如何退出程式？
A: 在第一個選擇畫面按 `ESC` 或 `Ctrl+C` 即可退出。

### Q: 能否跳過某個步驟？
A: 不能跳過，但可以按 ESC 返回選擇其他操作。

### Q: 為什麼沒有確認提示？
A: 新版設計理念是減少打擾，選擇完畢立即執行。如果選錯，處理速度很快，重新執行即可。

### Q: 能否同時處理多個資料夾？
A: 可以！處理完一個資料夾後會自動返回主選單，可以繼續處理下一個。

### Q: 方向鍵不起作用？
A: 確保終端支援 ANSI 轉義序列。Windows 用戶建議使用 Windows Terminal 或 Git Bash。

---

## 🎉 享受新體驗

新的 UI 設計讓整個操作流程更加流暢和愉悅！

有任何問題或建議，歡迎反饋 🙏

---

## 📚 相關文檔

- [圖片分割功能文檔](./IMAGE_SPLITTER.md)
- [InquirerPy 官方文檔](https://inquirerpy.readthedocs.io/)

---

**Sources:**
- [InquirerPy Documentation](https://inquirerpy.readthedocs.io/)
- [GitHub - kazhala/InquirerPy](https://github.com/kazhala/InquirerPy)
