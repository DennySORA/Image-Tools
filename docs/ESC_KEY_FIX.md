# ESC éµå°èˆªä¿®å¾©èªªæ˜

## ğŸ› å•é¡Œæè¿°

ä½¿ç”¨è€…å›å ±æŒ‰ ESC éµç„¡æ³•æ­£å¸¸è¿”å›ä¸Šä¸€å±¤é¸å–®çš„å•é¡Œã€‚

## ğŸ”§ ä¿®å¾©å…§å®¹

### 1. **ä¿®å¾©éè¿´å‘¼å«å•é¡Œ** âœ…

**å•é¡Œï¼š** `_select_folder()` æ–¹æ³•åœ¨è™•ç†è‡ªè¨‚è·¯å¾‘è¼¸å…¥æ™‚ä½¿ç”¨äº†éè¿´å‘¼å«ï¼š
```python
# âŒ éŒ¯èª¤çš„åšæ³•
if path_str is None:
    return self._select_folder()  # éè¿´å‘¼å«
```

**ä¿®å¾©ï¼š** æ”¹ç”¨ `while True` è¿´åœˆï¼Œä½¿ç”¨ `continue` é‡æ–°é€²å…¥è¿´åœˆï¼š
```python
# âœ… æ­£ç¢ºçš„åšæ³•
while True:
    # ... é¸æ“‡é‚è¼¯ ...
    if path_str is None:
        continue  # é‡æ–°é€²å…¥è¿´åœˆ
```

**å¥½è™•ï¼š**
- é¿å…å †ç–Šæº¢ä½
- æ›´æ¸…æ¥šçš„æ§åˆ¶æµç¨‹
- ç¬¦åˆ Python æœ€ä½³å¯¦è¸

---

### 2. **æ–°å¢æ˜ç¢ºçš„ã€Œè¿”å›ä¸Šä¸€æ­¥ã€é¸é …** âœ…

åœ¨æ‰€æœ‰é¸å–®ä¸­åŠ å…¥ `â¬…ï¸  è¿”å›ä¸Šä¸€æ­¥` é¸é …ä½œç‚ºå‚™é¸æ–¹æ¡ˆï¼š

```python
choices = [
    Separator("ğŸ¯ é¸æ“‡æ“ä½œé¡å‹"),
    Choice(value="watermark-removal", name="ğŸš¿ æ°´å°ç§»é™¤"),
    Choice(value="image-splitting", name="âœ‚ï¸  åœ–ç‰‡åˆ†å‰²"),
    Choice(value="background-removal", name="ğŸ¨ èƒŒæ™¯ç§»é™¤"),
    Separator(),
    Choice(value=None, name="â¬…ï¸  è¿”å›ä¸Šä¸€æ­¥"),  # æ–°å¢
]
```

**å¥½è™•ï¼š**
- å¦‚æœçµ‚ç«¯æ©Ÿä¸æ”¯æ´ ESC éµï¼Œä½¿ç”¨è€…ä»å¯è¿”å›
- æ›´ç›´è¦ºçš„è¦–è¦ºæç¤º
- ç›¸å®¹æ€§æ›´å¥½

---

### 3. **æ–°å¢é™¤éŒ¯è¼¸å‡º** ğŸ›

åœ¨æ¯å€‹æ­¥é©ŸåŠ å…¥ç‹€æ…‹è¨Šæ¯ï¼Œå¹«åŠ©ç¢ºèª ESC æ˜¯å¦æ­£ç¢ºé‹ä½œï¼š

```python
# é¸æ“‡å®Œæˆå¾Œ
print(f"\nâœ… å·²é¸æ“‡è³‡æ–™å¤¾: {folder}")

# ESC æŒ‰ä¸‹æ™‚
print("\nğŸ”™ ESC å·²æŒ‰ä¸‹ - è¿”å›è³‡æ–™å¤¾é¸æ“‡")
```

**å¥½è™•ï¼š**
- å³æ™‚å›é¥‹
- å¹«åŠ©é™¤éŒ¯
- ç¢ºèªå°èˆªè·¯å¾‘

---

### 4. **æ”¹é€²æ­¡è¿è¨Šæ¯** ğŸ“

æ›´æ–°æ­¡è¿è¨Šæ¯ï¼Œæ¸…æ¥šèªªæ˜å…©ç¨®è¿”å›æ–¹å¼ï¼š

```
ğŸ’¡ æç¤ºï¼š
   â€¢ ä½¿ç”¨ â†‘â†“ æ–¹å‘éµé¸æ“‡é¸é …
   â€¢ Enter ç¢ºèªé¸æ“‡
   â€¢ ESC æˆ–é¸æ“‡ã€Œâ¬…ï¸  è¿”å›ä¸Šä¸€æ­¥ã€è¿”å›ä¸Šä¸€å±¤
```

---

## ğŸ§ª æ¸¬è©¦æ–¹å¼

### æ–¹æ³• 1: åŸ·è¡Œä¸»ç¨‹å¼æ¸¬è©¦

```bash
python main.py
```

**æ¸¬è©¦æ¡ˆä¾‹ï¼š**

1. **è³‡æ–™å¤¾é¸æ“‡ â†’ ESC**
   - é æœŸï¼šé¡¯ç¤º "ğŸ‘‹ ESC å·²æŒ‰ä¸‹ - é€€å‡ºç¨‹å¼"ï¼Œç¨‹å¼çµæŸ

2. **è³‡æ–™å¤¾é¸æ“‡ â†’ æ“ä½œé¸æ“‡ â†’ ESC**
   - é æœŸï¼šé¡¯ç¤º "ğŸ”™ ESC å·²æŒ‰ä¸‹ - è¿”å›è³‡æ–™å¤¾é¸æ“‡"ï¼Œè¿”å›è³‡æ–™å¤¾é¸æ“‡

3. **è³‡æ–™å¤¾ â†’ æ“ä½œ â†’ å¾Œç«¯é¸æ“‡ â†’ ESC**
   - é æœŸï¼šé¡¯ç¤º "ğŸ”™ ESC å·²æŒ‰ä¸‹ - è¿”å›æ“ä½œé¸æ“‡"ï¼Œè¿”å›æ“ä½œé¸æ“‡

4. **ä½¿ç”¨ã€Œâ¬…ï¸  è¿”å›ä¸Šä¸€æ­¥ã€é¸é …**
   - é æœŸï¼šèˆ‡ ESC ç›¸åŒçš„æ•ˆæœ

### æ–¹æ³• 2: ä½¿ç”¨æ¸¬è©¦è…³æœ¬

```bash
python test_esc.py
```

é€™å€‹è…³æœ¬æœƒæ¸¬è©¦ InquirerPy çš„ ESC éµè¡Œç‚ºï¼Œç¢ºèªï¼š
- `mandatory=False` æ˜¯å¦æ­£ç¢ºè¿”å› `None`
- çµ‚ç«¯æ©Ÿæ˜¯å¦æ”¯æ´ ESC éµ
- ä¸‰å±¤é¸å–®å°èˆªæ˜¯å¦æ­£å¸¸

---

## ğŸ” é™¤éŒ¯æç¤º

### å¦‚æœ ESC ä»ç„¶ä¸å·¥ä½œï¼š

1. **æª¢æŸ¥çµ‚ç«¯æ©Ÿç›¸å®¹æ€§**
   ```bash
   echo $TERM
   # æ‡‰è©²æ˜¯ xterm-256color æˆ–é¡ä¼¼çš„å€¼
   ```

2. **ç¢ºèª InquirerPy ç‰ˆæœ¬**
   ```bash
   uv pip show inquirerpy
   # ç‰ˆæœ¬æ‡‰è©² >= 0.3.4
   ```

3. **æ¸¬è©¦çµ‚ç«¯æ©Ÿ ESC éµ**
   ```bash
   python test_esc.py
   ```
   å¦‚æœé€™å€‹æ¸¬è©¦è…³æœ¬çš„ ESC ä¹Ÿä¸å·¥ä½œï¼Œè¡¨ç¤ºæ˜¯çµ‚ç«¯æ©Ÿå•é¡Œï¼Œä¸æ˜¯ç¨‹å¼å•é¡Œã€‚

4. **ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ**
   ä½¿ç”¨æ–¹å‘éµé¸æ“‡ `â¬…ï¸  è¿”å›ä¸Šä¸€æ­¥` é¸é …

### Windows ä½¿ç”¨è€…

å»ºè­°ä½¿ç”¨ï¼š
- âœ… Windows Terminal
- âœ… Git Bash
- âŒ ä¸å»ºè­°ä½¿ç”¨ cmd.exeï¼ˆå¯èƒ½ä¸æ”¯æ´ ESCï¼‰

### Linux/macOS ä½¿ç”¨è€…

å¤§éƒ¨åˆ†çµ‚ç«¯æ©Ÿéƒ½æ”¯æ´ï¼Œå¦‚æœæœ‰å•é¡Œï¼š
- æª¢æŸ¥ `$TERM` ç’°å¢ƒè®Šæ•¸
- å˜—è©¦ä¸åŒçš„çµ‚ç«¯æ©Ÿæ¨¡æ“¬å™¨

---

## ğŸ“Š æŠ€è¡“ç´°ç¯€

### InquirerPy çš„ ESC è™•ç†æ©Ÿåˆ¶

```python
try:
    result = inquirer.select(
        message="é¸æ“‡:",
        choices=choices,
        mandatory=False,  # é—œéµï¼šå…è¨± ESC è¿”å› None
    ).execute()
except KeyboardInterrupt:
    # Ctrl+C æœƒè§¸ç™¼é€™è£¡
    return None

# ESC éµæœƒè®“ result = Noneï¼ˆä¸æœƒè§¸ç™¼ä¾‹å¤–ï¼‰
if result is None:
    return None
```

**é‡è¦è§€å¿µï¼š**
- `mandatory=False` â†’ ESC è¿”å› `None`
- `mandatory=True` â†’ ESC ç„¡æ•ˆï¼ˆé è¨­å€¼ï¼‰
- Ctrl+C â†’ è§¸ç™¼ `KeyboardInterrupt` ä¾‹å¤–

### å°èˆªæ¶æ§‹

```python
while True:                          # Level 1: è³‡æ–™å¤¾
    folder = select_folder()
    if folder is None:
        exit()                       # ESC = é€€å‡º

    while True:                      # Level 2: æ“ä½œ
        operation = select_operation()
        if operation is None:
            break                    # ESC = è¿”å› Level 1

        while True:                  # Level 3: å¾Œç«¯é…ç½®
            config = select_backend()
            if config is None:
                break                # ESC = è¿”å› Level 2

            return config            # å®Œæˆè¨­å®š
```

---

## âœ… é©—è­‰æ¸…å–®

- [x] ä¿®å¾©éè¿´å‘¼å«å•é¡Œ
- [x] æ‰€æœ‰é¸å–®åŠ å…¥ã€Œè¿”å›ä¸Šä¸€æ­¥ã€é¸é …
- [x] æ–°å¢é™¤éŒ¯è¼¸å‡ºè¨Šæ¯
- [x] æ›´æ–°æ­¡è¿è¨Šæ¯
- [x] é€šéç¨‹å¼ç¢¼æª¢æŸ¥ (ruff)
- [x] å»ºç«‹æ¸¬è©¦è…³æœ¬
- [x] å»ºç«‹ä¿®å¾©æ–‡æª”
- [x] æ¨é€åˆ°é ç«¯ (commit: aed12b0)

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [æ–°ç‰ˆ UI ä½¿ç”¨æŒ‡å—](./NEW_UI_GUIDE.md)
- [InquirerPy å®˜æ–¹æ–‡æª”](https://inquirerpy.readthedocs.io/)

---

æœ€å¾Œæ›´æ–°ï¼š2026-02-08
